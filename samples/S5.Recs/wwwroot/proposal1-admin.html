<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Sora Recs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        netflix: '#E50914',
                        netflixDark: '#141414',
                        netflixGray: '#333333'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-black text-white font-sans">
    <!-- Sidebar Navigation -->
    <nav class="fixed left-0 top-0 h-full w-64 bg-netflixDark border-r border-gray-800 z-50">
        <div class="p-6">
            <div class="flex items-center space-x-3 mb-8">
                <div class="w-8 h-8 bg-netflix rounded flex items-center justify-center">
                    <i class="fas fa-film text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold text-netflix">Sora Recs</h1>
            </div>
            
            <ul class="space-y-2">
                <li>
                    <a href="proposal1-index.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition-colors">
                        <i class="fas fa-home w-5"></i>
                        <span>Browse</span>
                    </a>
                </li>
                <li>
                    <a href="proposal1-admin.html" class="flex items-center space-x-3 p-3 rounded-lg bg-netflix text-white">
                        <i class="fas fa-cog w-5"></i>
                        <span>Admin Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="proposal1-status.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition-colors">
                        <i class="fas fa-chart-line w-5"></i>
                        <span>System Status</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="ml-64 p-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold mb-2">Admin Dashboard</h1>
                <p class="text-gray-400">Manage your recommendation system</p>
            </div>
            <div class="flex items-center space-x-4">
                <div class="bg-green-500 w-3 h-3 rounded-full"></div>
                <span class="text-sm text-gray-400">System Online</span>
            </div>
        </div>

        <!-- Data Management Section -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-6 flex items-center">
                <i class="fas fa-database mr-3 text-netflix"></i>
                Data Management
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Data Operations -->
                <div class="bg-netflixGray rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Database Operations</h3>
                    <div class="space-y-4">
                        <button id="seedDataBtn" class="w-full bg-netflix hover:bg-red-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i class="fas fa-seedling mr-2"></i>
                            Seed Sample Data
                        </button>
                        <button id="clearDataBtn" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i class="fas fa-trash mr-2"></i>
                            Clear All Data
                        </button>
                        <button id="refreshStatsBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i class="fas fa-sync mr-2"></i>
                            Refresh Statistics
                        </button>
                    </div>
                </div>

                <!-- Data Statistics -->
                <div class="bg-netflixGray rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Database Statistics</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-black rounded">
                            <span class="text-gray-300">Total Anime</span>
                            <span id="animeCount" class="text-white font-semibold">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-black rounded">
                            <span class="text-gray-300">Total Ratings</span>
                            <span id="ratingsCount" class="text-white font-semibold">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-black rounded">
                            <span class="text-gray-300">Unique Genres</span>
                            <span id="genresCount" class="text-white font-semibold">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-black rounded">
                            <span class="text-gray-300">Average Rating</span>
                            <span id="avgRating" class="text-white font-semibold">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-6 flex items-center">
                <i class="fas fa-chart-bar mr-3 text-netflix"></i>
                Analytics Dashboard
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Rating Distribution Chart -->
                <div class="bg-netflixGray rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Rating Distribution</h3>
                    <canvas id="ratingChart" width="400" height="200"></canvas>
                </div>

                <!-- Genre Popularity Chart -->
                <div class="bg-netflixGray rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Popular Genres</h3>
                    <canvas id="genreChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-netflixGray rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-netflix mb-2" id="searchCount">0</div>
                    <div class="text-gray-400">Total Searches</div>
                </div>
                <div class="bg-netflixGray rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-green-500 mb-2" id="avgResponseTime">0ms</div>
                    <div class="text-gray-400">Avg Response Time</div>
                </div>
                <div class="bg-netflixGray rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-blue-500 mb-2" id="uptime">99.9%</div>
                    <div class="text-gray-400">System Uptime</div>
                </div>
            </div>
        </div>

        <!-- System Configuration -->
        <div>
            <h2 class="text-2xl font-semibold mb-6 flex items-center">
                <i class="fas fa-sliders-h mr-3 text-netflix"></i>
                System Configuration
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Search Settings -->
                <div class="bg-netflixGray rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Search Settings</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Results Per Page</label>
                            <select class="w-full bg-black text-white border border-gray-600 rounded px-3 py-2">
                                <option value="12">12</option>
                                <option value="24" selected>24</option>
                                <option value="48">48</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Search Algorithm</label>
                            <select class="w-full bg-black text-white border border-gray-600 rounded px-3 py-2">
                                <option value="semantic" selected>Semantic Search</option>
                                <option value="text">Text Search</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Cache Settings -->
                <div class="bg-netflixGray rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Performance Settings</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Cache TTL (minutes)</label>
                            <input type="number" value="30" class="w-full bg-black text-white border border-gray-600 rounded px-3 py-2">
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-300">Enable Analytics</span>
                            <input type="checkbox" checked class="form-checkbox h-5 w-5 text-netflix">
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Status Messages -->
    <div id="statusMessage" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden">
        <i class="fas fa-check mr-2"></i>
        <span id="statusText">Operation completed successfully</span>
    </div>

    <script>
        // API Configuration
        const API_BASE = '/api';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadStatistics();
            initializeCharts();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('seedDataBtn').addEventListener('click', seedData);
            document.getElementById('clearDataBtn').addEventListener('click', clearData);
            document.getElementById('refreshStatsBtn').addEventListener('click', loadStatistics);
        }

        // Load database statistics
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/admin/stats`);
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('animeCount').textContent = stats.animeCount || '0';
                    document.getElementById('ratingsCount').textContent = stats.ratingsCount || '0';
                    document.getElementById('genresCount').textContent = stats.genresCount || '0';
                    document.getElementById('avgRating').textContent = (stats.avgRating || 0).toFixed(1);
                    
                    updateCharts(stats);
                }
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Seed sample data
        async function seedData() {
            try {
                showStatus('Seeding data...', 'info');
                const response = await fetch(`${API_BASE}/admin/seed`, { method: 'POST' });
                if (response.ok) {
                    showStatus('Data seeded successfully!', 'success');
                    setTimeout(loadStatistics, 1000);
                } else {
                    showStatus('Failed to seed data', 'error');
                }
            } catch (error) {
                console.error('Error seeding data:', error);
                showStatus('Error seeding data', 'error');
            }
        }

        // Clear all data
        async function clearData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                try {
                    showStatus('Clearing data...', 'info');
                    const response = await fetch(`${API_BASE}/admin/clear`, { method: 'DELETE' });
                    if (response.ok) {
                        showStatus('Data cleared successfully!', 'success');
                        setTimeout(loadStatistics, 1000);
                    } else {
                        showStatus('Failed to clear data', 'error');
                    }
                } catch (error) {
                    console.error('Error clearing data:', error);
                    showStatus('Error clearing data', 'error');
                }
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Rating Distribution Chart
            const ratingCtx = document.getElementById('ratingChart').getContext('2d');
            window.ratingChart = new Chart(ratingCtx, {
                type: 'bar',
                data: {
                    labels: ['1★', '2★', '3★', '4★', '5★'],
                    datasets: [{
                        label: 'Number of Ratings',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: ['#ef4444', '#f97316', '#eab308', '#22c55e', '#16a34a'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: { color: '#9ca3af' },
                            grid: { color: '#374151' }
                        },
                        x: { 
                            ticks: { color: '#9ca3af' },
                            grid: { color: '#374151' }
                        }
                    }
                }
            });

            // Genre Chart
            const genreCtx = document.getElementById('genreChart').getContext('2d');
            window.genreChart = new Chart(genreCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#E50914', '#DB2C3A', '#B91C1C', '#DC2626', '#EF4444',
                            '#F87171', '#FCA5A5', '#FECACA', '#FEE2E2', '#FEF2F2'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#9ca3af' }
                        }
                    }
                }
            });
        }

        // Update charts with new data
        function updateCharts(stats) {
            // Update rating chart
            if (stats.ratingDistribution && window.ratingChart) {
                window.ratingChart.data.datasets[0].data = stats.ratingDistribution;
                window.ratingChart.update();
            }

            // Update genre chart
            if (stats.genreStats && window.genreChart) {
                window.genreChart.data.labels = stats.genreStats.map(g => g.genre);
                window.genreChart.data.datasets[0].data = stats.genreStats.map(g => g.count);
                window.genreChart.update();
            }

            // Update performance metrics
            document.getElementById('searchCount').textContent = stats.searchCount || 0;
            document.getElementById('avgResponseTime').textContent = `${stats.avgResponseTime || 0}ms`;
        }

        // Show status message
        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('statusMessage');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = message;
            
            // Reset classes
            statusDiv.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg';
            
            // Add appropriate color class
            if (type === 'success') {
                statusDiv.classList.add('bg-green-500', 'text-white');
            } else if (type === 'error') {
                statusDiv.classList.add('bg-red-500', 'text-white');
            } else {
                statusDiv.classList.add('bg-blue-500', 'text-white');
            }
            
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
