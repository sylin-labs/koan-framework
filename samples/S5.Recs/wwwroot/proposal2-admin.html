<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Sora Recs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        discord: {
                            dark: '#2f3136',
                            darker: '#202225',
                            darkest: '#36393f',
                            blurple: '#5865f2',
                            green: '#57f287',
                            red: '#ed4245'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-discord-darker text-white font-sans overflow-hidden">
    <!-- Main Layout Container -->
    <div class="flex h-screen">
        <!-- Server List (Left) -->
        <div class="w-16 bg-discord-darkest flex flex-col items-center py-4 space-y-3">
            <!-- Home Server -->
            <div class="w-12 h-12 bg-discord-blurple rounded-2xl hover:rounded-xl transition-all duration-200 flex items-center justify-center cursor-pointer group">
                <i class="fas fa-film text-white group-hover:text-white"></i>
            </div>
            
            <!-- Separator -->
            <div class="w-8 h-0.5 bg-gray-600 rounded"></div>
            
            <!-- Admin Server -->
            <div class="w-12 h-12 bg-discord-red rounded-2xl hover:rounded-xl transition-all duration-200 flex items-center justify-center cursor-pointer">
                <i class="fas fa-cog text-white"></i>
            </div>
        </div>

        <!-- Channel List (Second Column) -->
        <div class="w-60 bg-discord-dark flex flex-col">
            <!-- Server Header -->
            <div class="h-16 px-4 flex items-center border-b border-gray-700 shadow-md">
                <h2 class="font-bold text-white">Admin Panel</h2>
                <i class="fas fa-chevron-down ml-auto text-gray-400 text-xs"></i>
            </div>

            <!-- Navigation Channels -->
            <div class="flex-1 px-2 overflow-y-auto pt-4">
                <!-- System Management -->
                <div class="mb-6">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide mb-2">
                        System Management
                    </div>
                    <div class="space-y-1">
                        <a href="proposal2-index.html" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group">
                            <i class="fas fa-home text-blue-500 w-4 mr-3"></i>
                            <span class="text-sm">Back to Browse</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-white bg-gray-700 rounded group" onclick="setActiveSection('overview')">
                            <i class="fas fa-chart-pie text-green-500 w-4 mr-3"></i>
                            <span class="text-sm">Overview</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('database')">
                            <i class="fas fa-database text-blue-500 w-4 mr-3"></i>
                            <span class="text-sm">Database</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('users')">
                            <i class="fas fa-users text-purple-500 w-4 mr-3"></i>
                            <span class="text-sm">User Analytics</span>
                        </a>
                        <a href="proposal2-status.html" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group">
                            <i class="fas fa-chart-line text-green-500 w-4 mr-3"></i>
                            <span class="text-sm">System Status</span>
                        </a>
                    </div>
                </div>

                <!-- Data Operations -->
                <div class="mb-6">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide mb-2">
                        Data Operations
                    </div>
                    <div class="space-y-1">
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('import')">
                            <i class="fas fa-download text-green-500 w-4 mr-3"></i>
                            <span class="text-sm">Import Data</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('export')">
                            <i class="fas fa-upload text-yellow-500 w-4 mr-3"></i>
                            <span class="text-sm">Export Data</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('backup')">
                            <i class="fas fa-save text-blue-500 w-4 mr-3"></i>
                            <span class="text-sm">Backup</span>
                        </a>
                    </div>
                </div>

                <!-- System Config -->
                <div class="mb-6">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide mb-2">
                        Configuration
                    </div>
                    <div class="space-y-1">
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('settings')">
                            <i class="fas fa-sliders-h text-gray-500 w-4 mr-3"></i>
                            <span class="text-sm">System Settings</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('api')">
                            <i class="fas fa-code text-orange-500 w-4 mr-3"></i>
                            <span class="text-sm">API Config</span>
                        </a>
                        <a href="#" class="flex items-center px-2 py-1.5 text-gray-300 hover:text-white hover:bg-gray-700 rounded group" onclick="setActiveSection('logs')">
                            <i class="fas fa-file-alt text-red-500 w-4 mr-3"></i>
                            <span class="text-sm">System Logs</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Admin User Bar -->
            <div class="h-16 px-2 flex items-center border-t border-gray-700 bg-discord-darkest">
                <div class="flex items-center space-x-2 flex-1">
                    <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-user-shield text-white text-xs"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium text-white truncate">Administrator</div>
                        <div class="text-xs text-gray-400">System Manager</div>
                    </div>
                </div>
                <div class="flex space-x-1">
                    <button class="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-700 rounded">
                        <i class="fas fa-bell text-xs"></i>
                    </button>
                    <button class="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-700 rounded">
                        <i class="fas fa-cog text-xs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col bg-discord-dark">
            <!-- Top Bar -->
            <div class="h-16 px-6 flex items-center border-b border-gray-700 shadow-sm">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-chart-pie text-green-500" id="sectionIcon"></i>
                    <h1 class="text-xl font-semibold text-white" id="sectionTitle">System Overview</h1>
                </div>
                
                <div class="ml-auto flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-sm text-gray-400">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span>System Online</span>
                    </div>
                    <button onclick="refreshData()" class="bg-discord-blurple hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors">
                        <i class="fas fa-sync mr-2"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto">
                <!-- Overview Section -->
                <div id="overview-section" class="p-6">
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-discord-darkest rounded-lg p-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Total Anime</p>
                                    <p class="text-2xl font-bold text-white" id="totalAnime">Loading...</p>
                                </div>
                                <div class="bg-blue-500 bg-opacity-20 p-3 rounded-full">
                                    <i class="fas fa-film text-blue-500"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-discord-darkest rounded-lg p-6 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">User Ratings</p>
                                    <p class="text-2xl font-bold text-white" id="totalRatings">Loading...</p>
                                </div>
                                <div class="bg-green-500 bg-opacity-20 p-3 rounded-full">
                                    <i class="fas fa-star text-green-500"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-discord-darkest rounded-lg p-6 border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Active Users</p>
                                    <p class="text-2xl font-bold text-white" id="activeUsers">Loading...</p>
                                </div>
                                <div class="bg-purple-500 bg-opacity-20 p-3 rounded-full">
                                    <i class="fas fa-users text-purple-500"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-discord-darkest rounded-lg p-6 border-l-4 border-yellow-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Daily Searches</p>
                                    <p class="text-2xl font-bold text-white" id="dailySearches">Loading...</p>
                                </div>
                                <div class="bg-yellow-500 bg-opacity-20 p-3 rounded-full">
                                    <i class="fas fa-search text-yellow-500"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-discord-darkest rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">User Activity (Last 7 Days)</h3>
                            <canvas id="activityChart"></canvas>
                        </div>

                        <div class="bg-discord-darkest rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Top Genres</h3>
                            <canvas id="genreChart"></canvas>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-discord-darkest rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Recent System Activity</h3>
                        <div class="space-y-3" id="recentActivity">
                            <div class="flex items-center space-x-3 p-3 bg-discord-dark rounded">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <span class="text-sm text-gray-300">Database backup completed successfully</span>
                                <span class="text-xs text-gray-500 ml-auto">2 minutes ago</span>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-discord-dark rounded">
                                <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                <span class="text-sm text-gray-300">New anime data imported: 15 items</span>
                                <span class="text-xs text-gray-500 ml-auto">1 hour ago</span>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-discord-dark rounded">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                <span class="text-sm text-gray-300">High API usage detected</span>
                                <span class="text-xs text-gray-500 ml-auto">3 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Database Section -->
                <div id="database-section" class="p-6 hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Database Operations -->
                        <div class="bg-discord-darkest rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Database Operations</h3>
                            <div class="space-y-4">
                                <button id="seedDataBtn" onclick="seedData()" class="w-full bg-discord-green hover:bg-green-600 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                    <i class="fas fa-seedling mr-2"></i>
                                    Seed Sample Data
                                </button>
                                <button id="clearDataBtn" onclick="clearData()" class="w-full bg-discord-red hover:bg-red-600 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                    <i class="fas fa-trash mr-2"></i>
                                    Clear All Data
                                </button>
                                <button onclick="optimizeDatabase()" class="w-full bg-discord-blurple hover:bg-blue-600 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                                    <i class="fas fa-rocket mr-2"></i>
                                    Optimize Database
                                </button>
                            </div>
                        </div>

                        <!-- Database Stats -->
                        <div class="bg-discord-darkest rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Database Statistics</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-discord-dark rounded">
                                    <span class="text-gray-300">Total Records</span>
                                    <span class="text-white font-semibold" id="dbTotalRecords">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-discord-dark rounded">
                                    <span class="text-gray-300">Database Size</span>
                                    <span class="text-white font-semibold" id="dbSize">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-discord-dark rounded">
                                    <span class="text-gray-300">Last Backup</span>
                                    <span class="text-white font-semibold" id="lastBackup">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-discord-dark rounded">
                                    <span class="text-gray-300">Connection Pool</span>
                                    <span class="text-white font-semibold" id="connectionPool">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other sections would be implemented similarly -->
                <div id="users-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">User Analytics</h3>
                    <p class="text-gray-400">User analytics dashboard coming soon...</p>
                </div>

                <div id="import-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">Data Import</h3>
                    <p class="text-gray-400">Data import tools coming soon...</p>
                </div>

                <div id="export-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">Data Export</h3>
                    <p class="text-gray-400">Data export tools coming soon...</p>
                </div>

                <div id="backup-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">Backup Management</h3>
                    <p class="text-gray-400">Backup management tools coming soon...</p>
                </div>

                <div id="settings-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">System Settings</h3>
                    <p class="text-gray-400">System configuration coming soon...</p>
                </div>

                <div id="api-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">API Configuration</h3>
                    <p class="text-gray-400">API settings coming soon...</p>
                </div>

                <div id="logs-section" class="p-6 hidden">
                    <h3 class="text-lg font-semibold text-white mb-4">System Logs</h3>
                    <p class="text-gray-400">Log viewer coming soon...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Toast -->
    <div id="statusToast" class="fixed bottom-4 right-4 bg-discord-green text-white px-6 py-3 rounded-lg shadow-lg hidden">
        <i class="fas fa-check mr-2"></i>
        <span id="toastMessage">Operation completed successfully</span>
    </div>

    <script>
        // Current active section
        let currentSection = 'overview';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeCharts();
        });

        // Navigation
        function setActiveSection(section) {
            // Hide all sections
            document.querySelectorAll('[id$="-section"]').forEach(el => el.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(section + '-section').classList.remove('hidden');
            
            // Update navigation active state
            document.querySelectorAll('.bg-gray-700').forEach(el => {
                el.classList.remove('bg-gray-700', 'text-white');
                el.classList.add('text-gray-300');
            });
            
            event.target.closest('a').classList.add('bg-gray-700', 'text-white');
            event.target.closest('a').classList.remove('text-gray-300');
            
            // Update header
            const titles = {
                overview: { title: 'System Overview', icon: 'fas fa-chart-pie' },
                database: { title: 'Database Management', icon: 'fas fa-database' },
                users: { title: 'User Analytics', icon: 'fas fa-users' },
                import: { title: 'Data Import', icon: 'fas fa-download' },
                export: { title: 'Data Export', icon: 'fas fa-upload' },
                backup: { title: 'Backup Management', icon: 'fas fa-save' },
                settings: { title: 'System Settings', icon: 'fas fa-sliders-h' },
                api: { title: 'API Configuration', icon: 'fas fa-code' },
                logs: { title: 'System Logs', icon: 'fas fa-file-alt' }
            };
            
            const sectionInfo = titles[section] || { title: 'Admin Panel', icon: 'fas fa-cog' };
            document.getElementById('sectionTitle').textContent = sectionInfo.title;
            document.getElementById('sectionIcon').className = sectionInfo.icon + ' text-green-500';
            
            currentSection = section;
            
            // Load section-specific data
            loadSectionData(section);
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/admin/stats');
                if (response.ok) {
                    const stats = await response.json();
                    updateDashboardStats(stats);
                } else {
                    loadMockData();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                loadMockData();
            }
        }

        function loadMockData() {
            updateDashboardStats({
                totalAnime: 1247,
                totalRatings: 3892,
                activeUsers: 156,
                dailySearches: 542,
                dbTotalRecords: 15673,
                dbSize: '2.3 GB',
                lastBackup: '2 hours ago',
                connectionPool: '8/20'
            });
        }

        function updateDashboardStats(stats) {
            document.getElementById('totalAnime').textContent = stats.totalAnime?.toLocaleString() || '0';
            document.getElementById('totalRatings').textContent = stats.totalRatings?.toLocaleString() || '0';
            document.getElementById('activeUsers').textContent = stats.activeUsers?.toLocaleString() || '0';
            document.getElementById('dailySearches').textContent = stats.dailySearches?.toLocaleString() || '0';
            
            if (stats.dbTotalRecords) {
                document.getElementById('dbTotalRecords').textContent = stats.dbTotalRecords.toLocaleString();
            }
            if (stats.dbSize) {
                document.getElementById('dbSize').textContent = stats.dbSize;
            }
            if (stats.lastBackup) {
                document.getElementById('lastBackup').textContent = stats.lastBackup;
            }
            if (stats.connectionPool) {
                document.getElementById('connectionPool').textContent = stats.connectionPool;
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Searches',
                        data: [120, 190, 300, 500, 200, 300, 450],
                        borderColor: '#5865f2',
                        backgroundColor: 'rgba(88, 101, 242, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Ratings',
                        data: [80, 120, 180, 280, 150, 200, 280],
                        borderColor: '#57f287',
                        backgroundColor: 'rgba(87, 242, 135, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: { color: '#9ca3af' }
                        }
                    },
                    scales: {
                        y: { 
                            ticks: { color: '#9ca3af' },
                            grid: { color: '#374151' }
                        },
                        x: { 
                            ticks: { color: '#9ca3af' },
                            grid: { color: '#374151' }
                        }
                    }
                }
            });

            // Genre Chart
            const genreCtx = document.getElementById('genreChart').getContext('2d');
            new Chart(genreCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Action', 'Romance', 'Comedy', 'Drama', 'Fantasy'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: [
                            '#ef4444', '#ec4899', '#eab308', '#3b82f6', '#8b5cf6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#9ca3af' }
                        }
                    }
                }
            });
        }

        // Database operations
        async function seedData() {
            try {
                showToast('Seeding data...', 'info');
                const response = await fetch('/api/admin/seed', { method: 'POST' });
                if (response.ok) {
                    showToast('Data seeded successfully!', 'success');
                    setTimeout(refreshData, 1000);
                } else {
                    showToast('Failed to seed data', 'error');
                }
            } catch (error) {
                console.error('Error seeding data:', error);
                showToast('Error seeding data', 'error');
            }
        }

        async function clearData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                try {
                    showToast('Clearing data...', 'info');
                    const response = await fetch('/api/admin/clear', { method: 'DELETE' });
                    if (response.ok) {
                        showToast('Data cleared successfully!', 'success');
                        setTimeout(refreshData, 1000);
                    } else {
                        showToast('Failed to clear data', 'error');
                    }
                } catch (error) {
                    console.error('Error clearing data:', error);
                    showToast('Error clearing data', 'error');
                }
            }
        }

        async function optimizeDatabase() {
            try {
                showToast('Optimizing database...', 'info');
                // Simulate API call
                setTimeout(() => {
                    showToast('Database optimized successfully!', 'success');
                }, 2000);
            } catch (error) {
                console.error('Error optimizing database:', error);
                showToast('Error optimizing database', 'error');
            }
        }

        // Load section-specific data
        function loadSectionData(section) {
            switch(section) {
                case 'database':
                    // Database section is already loaded
                    break;
                case 'users':
                    // Load user analytics
                    break;
                // Add other cases as needed
            }
        }

        function refreshData() {
            loadDashboardData();
            if (currentSection === 'overview') {
                // Refresh charts if needed
            }
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const toast = document.getElementById('statusToast');
            const messageEl = document.getElementById('toastMessage');
            
            messageEl.textContent = message;
            
            // Reset classes
            toast.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg';
            
            // Add appropriate color class
            if (type === 'success') {
                toast.classList.add('bg-discord-green');
            } else if (type === 'error') {
                toast.classList.add('bg-discord-red');
            } else {
                toast.classList.add('bg-discord-blurple');
            }
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
