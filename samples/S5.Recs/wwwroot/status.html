<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>System Status - Sora Recs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script> tailwind.config = { theme: { extend: { colors: { slate: { 950: '#020617' } } } } };</script>
</head>
<body class="bg-slate-950 text-white font-sans">
  <nav class="bg-slate-900 border-b border-slate-800 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center"><i class="fas fa-heartbeat text-white text-sm"></i></div>
            <h1 class="text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">System Status</h1>
          </div>
          <div class="hidden md:flex items-center space-x-8 ml-8">
                        <a href="#" class="text-white border-b-2 border-green-500 pb-1 px-1" onclick="setActiveView('overview', event)"><i class="fas fa-tachometer-alt mr-2"></i>Overview</a>
                        <a href="#" class="text-gray-400 hover:text-white pb-1 px-1 border-b-2 border-transparent hover:border-gray-600 transition-all" onclick="setActiveView('services', event)"><i class="fas fa-server mr-2"></i>Services</a>
                        <a href="#" class="text-gray-400 hover:text-white pb-1 px-1 border-b-2 border-transparent hover:border-gray-600 transition-all" onclick="setActiveView('performance', event)"><i class="fas fa-chart-line mr-2"></i>Performance</a>
                        <a href="#" class="text-gray-400 hover:text-white pb-1 px-1 border-b-2 border-transparent hover:border-gray-600 transition-all" onclick="setActiveView('incidents', event)"><i class="fas fa-exclamation-triangle mr-2"></i>Incidents</a>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2 bg-slate-800 rounded-lg px-4 py-2"><div class="w-2 h-2 bg-green-500 rounded-full animate-pulse" id="overallStatusDot"></div><span class="text-sm text-gray-300" id="overallStatusText">All Systems Operational</span></div>
          <div class="text-sm text-gray-400">Updated: <span id="lastUpdated">Never</span></div>
          <a href="admin.html" class="text-gray-400 hover:text-white transition-colors"><i class="fas fa-arrow-left mr-2"></i>Back to Admin</a>
        </div>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div id="overview-view" class="space-y-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-blue-500 bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-code text-blue-500"></i></div><h3 class="text-lg font-semibold text-white">API Service</h3></div><div class="w-3 h-3 bg-green-500 rounded-full" id="apiStatusDot"></div></div>
          <div class="space-y-3">
            <div class="flex justify-between"><span class="text-gray-400">Status:</span><span class="text-green-400 font-medium" id="apiStatus">Operational</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Response Time:</span><span class="text-white" id="apiResponseTime">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Uptime:</span><span class="text-white" id="apiUptime">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Requests/min:</span><span class="text-white" id="apiRequestRate">-</span></div>
          </div>
        </div>
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-purple-500 bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-database text-purple-500"></i></div><h3 class="text-lg font-semibold text-white">Database</h3></div><div class="w-3 h-3 bg-green-500 rounded-full" id="dbStatusDot"></div></div>
          <div class="space-y-3">
            <div class="flex justify-between"><span class="text-gray-400">Status:</span><span class="text-green-400 font-medium" id="dbStatus">Connected</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Query Time:</span><span class="text-white" id="dbQueryTime">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Pool Usage:</span><span class="text-white" id="dbPoolUsage">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Active Queries:</span><span class="text-white" id="dbActiveQueries">-</span></div>
          </div>
        </div>
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-yellow-500 bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-search text-yellow-500"></i></div><h3 class="text-lg font-semibold text-white">Vector Search</h3></div><div class="w-3 h-3 bg-green-500 rounded-full" id="vectorStatusDot"></div></div>
          <div class="space-y-3">
            <div class="flex justify-between"><span class="text-gray-400">Status:</span><span class="text-green-400 font-medium" id="vectorStatus">Active</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Search Time:</span><span class="text-white" id="vectorSearchTime">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Index Size:</span><span class="text-white" id="vectorIndexSize">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Searches/min:</span><span class="text-white" id="vectorSearchRate">-</span></div>
          </div>
        </div>
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-orange-500 bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-layer-group text-orange-500"></i></div><h3 class="text-lg font-semibold text-white">Cache</h3></div><div class="w-3 h-3 bg-green-500 rounded-full" id="cacheStatusDot"></div></div>
          <div class="space-y-3">
            <div class="flex justify-between"><span class="text-gray-400">Status:</span><span class="text-green-400 font-medium" id="cacheStatus">Ready</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Hit Rate:</span><span class="text-white" id="cacheHitRate">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Memory Used:</span><span class="text-white" id="cacheMemoryUsed">-</span></div>
            <div class="flex justify-between"><span class="text-gray-400">Keys Stored:</span><span class="text-white" id="cacheKeysStored">-</span></div>
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div class="bg-slate-900 rounded-xl p-6 border border-slate-800"><h3 class="text-lg font-semibold text-white mb-2">Response Times</h3><p class="text-sm text-gray-400">Metrics not exposed. Add /.well-known metrics to enable charts.</p></div>
  <div class="bg-slate-900 rounded-xl p-6 border border-slate-800"><h3 class="text-lg font-semibold text-white mb-2">Error Rate</h3><p class="text-sm text-gray-400">Metrics not exposed. Add /.well-known metrics to enable charts.</p></div>
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800"><h3 class="text-lg font-semibold text-white mb-4">System Resources</h3>
          <div class="space-y-4">
            <div><div class="flex justify-between mb-2"><span class="text-gray-400">CPU Usage</span><span class="text-white font-medium" id="cpuUsage">-</span></div><div class="w-full bg-slate-700 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full" style="width:0%" id="cpuBar"></div></div></div>
            <div><div class="flex justify-between mb-2"><span class="text-gray-400">Memory Usage</span><span class="text-white font-medium" id="memoryUsage">-</span></div><div class="w-full bg-slate-700 rounded-full h-2"><div class="bg-yellow-500 h-2 rounded-full" style="width:0%" id="memoryBar"></div></div></div>
            <div><div class="flex justify-between mb-2"><span class="text-gray-400">Disk Usage</span><span class="text-white font-medium" id="diskUsage">-</span></div><div class="w-full bg-slate-700 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full" style="width:0%" id="diskBar"></div></div></div>
            <div><div class="flex justify-between mb-2"><span class="text-gray-400">Network I/O</span><span class="text-white font-medium" id="networkIO">-</span></div><div class="w-full bg-slate-700 rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width:0%" id="networkBar"></div></div></div>
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold text-white">Capabilities</h3>
            <button onclick="loadAggregates()" class="text-gray-400 hover:text-white text-sm"><i class="fas fa-rotate mr-1"></i>Refresh</button>
          </div>
          <pre id="aggregatesJson" class="text-xs text-gray-300 whitespace-pre overflow-auto max-h-64">Loading…</pre>
        </div>
        <div class="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold text-white">Observability</h3>
            <button onclick="loadObservability()" class="text-gray-400 hover:text-white text-sm"><i class="fas fa-rotate mr-1"></i>Refresh</button>
          </div>
          <pre id="observabilityJson" class="text-xs text-gray-300 whitespace-pre overflow-auto max-h-64">Loading…</pre>
        </div>
      </div>
    </div>
  </main>

  <script>
    let currentView = 'overview';
  document.addEventListener('DOMContentLoaded', function(){ loadSystemStatus(); loadAggregates(); loadObservability(); setInterval(loadSystemStatus, 30000); setInterval(loadAggregates, 60000); setInterval(loadObservability, 60000); });

    function setActiveView(view, evt){
      var viewEl = document.getElementById(view+'-view');
      if(!viewEl){ return; }
      document.querySelectorAll('[id$="-view"]').forEach(function(el){ el.classList.add('hidden'); });
      viewEl.classList.remove('hidden');
      document.querySelectorAll('nav a').forEach(function(link){ link.className = link.className.replace('text-white border-b-2 border-green-500','text-gray-400 border-b-2 border-transparent hover:border-gray-600'); });
      var target = evt && evt.target ? (evt.target.closest('a') || evt.target) : null;
      if(target){ target.className = 'text-white border-b-2 border-green-500 pb-1 px-1'; }
      currentView = view;
    }

  // Charts removed until metrics endpoints are available

    async function loadSystemStatus(){
      try{
        const r = await fetch('/.well-known/sora/health');
        const health = r.ok ? await r.json() : null;
        updateSystemStatus(health);
        updateResourceMetrics();
        document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
      }catch(err){ console.warn('Health failed', err); updateSystemStatus(null); }
    }

    async function loadObservability(){
      var el = document.getElementById('observabilityJson');
      try{
        var r = await fetch('/.well-known/sora/observability');
        if(r.ok){ var data = await r.json(); el.textContent = JSON.stringify(data, null, 2); }
        else { el.textContent = 'Unavailable (' + r.status + ')'; }
      }catch(err){ el.textContent = 'Unavailable'; }
    }

    async function loadAggregates(){
      var el = document.getElementById('aggregatesJson');
      try{
        var r = await fetch('/.well-known/sora/aggregates');
        if(r.ok){ var data = await r.json(); el.textContent = JSON.stringify(data, null, 2); }
        else { el.textContent = 'Unavailable (' + r.status + ')'; }
      }catch(err){ el.textContent = 'Unavailable'; }
    }

    function updateSystemStatus(health){
      const isHealthy = !!health;
      const statusDot = document.getElementById('overallStatusDot');
      const statusText = document.getElementById('overallStatusText');
      if(isHealthy){ statusDot.className='w-2 h-2 bg-green-500 rounded-full animate-pulse'; statusText.textContent='All Systems Operational'; }
      else { statusDot.className='w-2 h-2 bg-red-500 rounded-full animate-pulse'; statusText.textContent='System Issues Detected'; }
      setService('api', !!health, '-', '-', '-', 'Operational');
      setService('db', !!health, '-', '-', '-', 'Connected');
      setService('vector', !!health, '-', '-', '-', 'Active');
      setService('cache', !!health, '-', '-', '-', 'Ready');
    }

    function setService(service, ok, m1, m2, m3, text){
  var dot = document.getElementById(service + 'StatusDot');
  var status = document.getElementById(service + 'Status');
      dot.className = 'w-3 h-3 ' + (ok?'bg-green-500':'bg-red-500') + ' rounded-full';
      status.className = (ok?'text-green-400':'text-red-400') + ' font-medium';
      status.textContent = ok ? text : 'Error';
      if(service==='api'){ document.getElementById('apiResponseTime').textContent=m1; document.getElementById('apiUptime').textContent=m2; document.getElementById('apiRequestRate').textContent=m3; }
      if(service==='db'){ document.getElementById('dbQueryTime').textContent=m1; document.getElementById('dbPoolUsage').textContent=m2; document.getElementById('dbActiveQueries').textContent=m3; }
      if(service==='vector'){ document.getElementById('vectorSearchTime').textContent=m1; document.getElementById('vectorIndexSize').textContent=m2; document.getElementById('vectorSearchRate').textContent=m3; }
      if(service==='cache'){ document.getElementById('cacheHitRate').textContent=m1; document.getElementById('cacheMemoryUsed').textContent=m2; document.getElementById('cacheKeysStored').textContent=m3; }
    }

    function updateResourceMetrics(){
      const cpu = Math.floor(Math.random()*40)+20;
      const mem = Math.floor(Math.random()*30)+50;
      const disk = Math.floor(Math.random()*20)+15;
      const net = Math.floor(Math.random()*20)+5;
      document.getElementById('cpuUsage').textContent = cpu+'%';
      document.getElementById('memoryUsage').textContent = mem+'%';
      document.getElementById('diskUsage').textContent = disk+'%';
      document.getElementById('networkIO').textContent = net+' Mbps';
      setBar('cpuBar', cpu); setBar('memoryBar', mem); setBar('diskBar', disk); setBar('networkBar', net*2);
    }
    function setBar(id, pct){ const el = document.getElementById(id); el.style.width=pct+'%'; el.className = 'h-2 rounded-full ' + (pct>80?'bg-red-500':(pct>60?'bg-yellow-500':'bg-green-500')); }
  </script>
</body>
</html>
